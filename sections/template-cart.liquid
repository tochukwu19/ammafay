<div class="cart-page my-8">
  <div class="container mx-auto px-4 md:px-8">
    
    {% if cart.item_count == 0 %}
      <div class="empty-cart text-center py-16">
        <h1 class="text-2xl font-[500] uppercase mb-4">Your Cart is Empty</h1>
        <p class="text-gray-600 mb-8">Add some products to get started</p>
        <a href="{{ routes.collections_url }}" class="inline-block px-8 py-3 bg-black text-white uppercase hover:bg-gray-700 transition-colors">
          Continue Shopping
        </a>
      </div>
    {% else %}
      <div class="cart-header mb-8">
        <h1 class="text-2xl font-[500] uppercase">Cart ({{ cart.item_count }})</h1>
      </div>

      <form action="{{ routes.cart_url }}" method="post" novalidate class="cart-form">
        
        <div class="cart-items space-y-6 mb-8">
          {% for item in cart.items %}
            <div class="cart-item flex flex-col md:flex-row gap-4 py-6 border-b border-gray-200" data-cart-item="{{ item.key }}">
              
              <div class="w-full md:w-32 h-32 flex-shrink-0">
                {% if item.image %}
                  <img src="{{ item.image | image_url: width: 200 }}" 
                       alt="{{ item.title }}" 
                       class="w-full h-full object-cover">
                {% else %}
                  <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                    <span class="text-gray-400 text-xs">No Image</span>
                  </div>
                {% endif %}
              </div>

              <div class="flex-grow">
                <div class="flex justify-between items-start mb-2">
                  <div>
                    <h3 class="font-[500] text-[18px] uppercase">
                      <a href="{{ item.url }}" class="hover:underline">{{ item.product.title }}</a>
                    </h3>
                    {% if item.variant.title != 'Default Title' %}
                      <p class="text-sm text-gray-600 uppercase">{{ item.variant.title }}</p>
                    {% endif %}
                  </div>
                  <button type="button" 
                          class="remove-item text-gray-400 hover:text-black transition-colors ml-4"
                          data-cart-remove="{{ item.key }}">
                    âœ•
                  </button>
                </div>

                {% if item.properties.size > 0 %}
                  <div class="mb-3">
                    {% for property in item.properties %}
                      {% unless property.first == '_preorder' %}
                        {% if property.first == 'Expected Ship Date' %}
                          <div class="text-xs bg-blue-50 text-blue-800 px-2 py-1 rounded inline-block">
                            Expected to ship: {{ property.last | date: '%B %d, %Y' }}
                          </div>
                        {% endif %}
                      {% endunless %}
                    {% endfor %}
                  </div>
                {% endif %}

                <div class="flex items-center justify-between">
                  <div class="quantity-selector flex items-center gap-2 border border-black px-3 py-2">
                    <button type="button" 
                            class="quantity-decrease w-6 h-6 flex items-center justify-center"
                            data-cart-quantity-decrease="{{ item.key }}">
                      -
                    </button>
                    <input type="number" 
                           name="updates[{{ item.key }}]" 
                           value="{{ item.quantity }}" 
                           min="0"
                           class="quantity-input w-12 text-center outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                           data-cart-quantity="{{ item.key }}">
                    <button type="button" 
                            class="quantity-increase w-6 h-6 flex items-center justify-center"
                            data-cart-quantity-increase="{{ item.key }}">
                      +
                    </button>
                  </div>
                  
                  <div class="text-right">
                    <p class="font-[500] text-[18px]">{{ item.final_line_price | money_with_currency }}</p>
                    {% if item.quantity > 1 %}
                      <p class="text-sm text-gray-600">{{ item.final_price | money_with_currency }} each</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="cart-summary bg-gray-50 p-6 rounded">
          <div class="space-y-3 mb-6">
            <div class="flex justify-between items-center">
              <span class="text-sm uppercase">Subtotal</span>
              <span class="font-[500]">{{ cart.total_price | money_with_currency }}</span>
            </div>
            
            <div class="border-t pt-3">
              <p class="text-xs text-gray-600 mb-4">
                Shipping and taxes calculated at checkout
              </p>
            </div>
          </div>

          <button type="submit" 
                  name="checkout" 
                  class="w-full bg-black text-white py-4 uppercase font-[500] hover:bg-gray-700 transition-colors mb-4">
            Checkout
          </button>
          
          <a href="{{ routes.collections_url }}" 
             class="block text-center text-sm text-gray-600 hover:text-black transition-colors uppercase">
            Continue Shopping
          </a>
        </div>

      </form>
    {% endif %}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  
  document.querySelectorAll('[data-cart-quantity-decrease]').forEach(button => {
    button.addEventListener('click', function() {
      const key = this.dataset.cartQuantityDecrease;
      const input = document.querySelector(`[data-cart-quantity="${key}"]`);
      if (input.value > 1) {
        input.value = parseInt(input.value) - 1;
        updateCart();
      }
    });
  });

  document.querySelectorAll('[data-cart-quantity-increase]').forEach(button => {
    button.addEventListener('click', function() {
      const key = this.dataset.cartQuantityIncrease;
      const input = document.querySelector(`[data-cart-quantity="${key}"]`);
      input.value = parseInt(input.value) + 1;
      updateCart();
    });
  });

  document.querySelectorAll('[data-cart-remove]').forEach(button => {
    button.addEventListener('click', function() {
      const key = this.dataset.cartRemove;
      const input = document.querySelector(`[data-cart-quantity="${key}"]`);
      input.value = 0;
      updateCart();
    });
  });

  document.querySelectorAll('[data-cart-quantity]').forEach(input => {
    input.addEventListener('change', function() {
      if (this.value < 0) this.value = 0;
      updateCart();
    });
  });

  function updateCart() {
    const form = document.querySelector('.cart-form');
    const formData = new FormData(form);
    
    fetch('/cart/update.js', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(() => {
      location.reload();
    })
    .catch(error => {
      console.error('Error updating cart:', error);
    });
  }

});
</script>

<style>
.cart-item {
  transition: opacity 0.3s ease;
}

.quantity-selector button {
  transition: background-color 0.2s ease;
}

.quantity-selector button:hover {
  background-color: #f3f4f6;
}

.remove-item {
  font-size: 18px;
  line-height: 1;
}

@media (max-width: 768px) {
  .cart-item {
    text-align: left;
  }
  
  .quantity-selector {
    width: 120px;
  }
}
</style>